<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Planning Poker</title>
        
        <link rel="stylesheet" type="text/css" href="content/style.css" />
        
        
        <!-- jQuery is only for signalR -->
        <script src="http://localhost/PlanningPoker.Server/Scripts/jquery-1.10.2.min.js"></script>
        <script src="http://localhost/PlanningPoker.Server/Scripts/jquery.signalR-2.2.0.min.js"></script>
        <script src="http://localhost/PlanningPoker.Server/signalr/hubs"></script>
        
        <script src="core.js"></script>
        
        <script src="DI.js"></script>
        <script src="Router.js"></script>
        <script src="RenderEngine.js"></script>

        <script type="text/javascript">
            var PlanningPoker = {};
            NS.init(PlanningPoker);
        </script>

        

        <script src="services/PokerTableSvc.js"></script>

        <script src="controllers/ControllerBase.js"></script>
        <script src="controllers/HomeController.js"></script>
        <script src="controllers/TableController.js"></script>

        <script src="views/home/index.js"></script>
        <script src="views/home/table.js"></script>

        <script src="components/Hand.js"></script>
        <script src="components/Card.js"></script>
        <script src="components/PlayersList.js"></script>
        <script src="components/Player.js"></script>
    </head>

    <body>

        <header>
            
        </header>

        <div id="body-section">
        </div>

        <footer>
            
        </footer>
                
        <script type="text/javascript">

            (function (pp) {
            
                var app = new Router({
                    virtualDirectory: '/planning.poker.vanillajs',
                    body: _("#body-section"),
                    routes: [
                        {
                            name: "home",
                            pattern: "/index2.html",
                            defaults: { lang: "en", controller: "Home", action: "index" }
                        },
                        {
                            name: "play",
                            pattern: "/play.html",
                            defaults: { lang: "en", controller: "Table", action: "index" }
                        },
                        {
                            name: "default-with-language",
                            pattern: "/:lang/:controller?/:action?/:id?",
                            defaults: { controller: "Home", action: "index" },
                            constraints: {
                                lang: function (val) {
                                    return (val || "").length == 2;
                                }
                            }
                        },
                        {
                            name: "default",
                            pattern: "/:controller?/:action?/:id?",
                            defaults: { lang: "en", controller: "Home", action: "index" }
                        }
                    ]
                });

                app.use(function (next, config) {
                    // if not joined, redirect to home
                    if (this.routeData.name != "home" && !this.joined) {
                        this.navigateToRoute("home");
                        return;
                    }

                    next();
                });

                app.use(Router.actionHandler);

                //#region DI

                DI.register("app", Router, function () {
                    return app;
                });

                DI.register("controller.home", HomeController, DI.singleton);
                DI.register("controller.table", TableController, DI.singleton);

                DI.register("component.playersList", PlayersList, DI.transient);
                DI.register("component.playersList.view", PlayersListView, DI.transient);
                
                DI.register("component.hand", Hand, DI.transient);
                DI.register("component.hand.view", HandView, DI.transient);
        
                //#endregion

                Re.componentFactory = new (function () {
                    this.create = function (name) {
                        return DI.resolve("component." + name);
                    };

                    this.createView = function (name, component, DOMcontext)  {
                        return DI.resolve("component." + name + ".view", component, DOMcontext);
                    };
                });

                app.controllerFactory = new (function () {
                    this.create = function (name) {
                        return DI.resolve("controller." + name);
                    }
                });


                // Start the connection and then start app
                DI.resolve("PokerTableSvc").hub
                    .start()
                    .then(function () {
                        app.start(window.location.pathname);
                    });
                    
            })(PlanningPoker);

        </script>
        
    </body>
</html>